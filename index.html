<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Adesão ao Programa REURB - JBD</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f8f9fa;
      margin: 0;
      padding: 0;
      display: flex;
      justify-content: center;
    }
    .container {
      background-color: white;
      border-radius: 8px;
      padding: 30px;
      margin: 20px;
      max-width: 700px;
      width: 100%;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    .logo { text-align: center; margin-bottom: 20px; }
    .logo img { width: 120px; }
    h1 { text-align: center; color: #003366; }
    label { display: block; margin-top: 10px; }
    input, select, textarea {
      width: 100%;
      padding: 8px;
      margin-top: 4px;
      border: 1px solid #ccc;
      border-radius: 4px;
      box-sizing: border-box;
    }
    textarea { resize: vertical; min-height: 200px; }
    .checkbox { margin-top: 15px; }
    button {
      margin-top: 20px; padding: 12px; width: 100%;
      border: none; background-color: #003366; color: white;
      font-weight: bold; border-radius: 4px; cursor: pointer;
    }
    button:disabled { background-color: #999; cursor: not-allowed; }

    /* Destaque visual para campos travados */
    .locked {
      background-color: #f1f3f5;
      color: #495057;
      border-color: #dee2e6;
    }
    .hint {
      font-size: 12px; color: #666; margin-top: 4px;
    }
  </style>
</head>
<body>
<div class="container">
  <div class="logo">
    <img src="logo.png" alt="Logo JBD">
  </div>
  <h1>Adesão ao Programa REURB</h1>

  <form id="formAdesao">
    <label>Nome completo: <input type="text" id="nome" required></label>
    <label>RG: <input type="text" id="rg" required></label>
    <label>Órgão Expedidor: <input type="text" id="orgao" required></label>
    <label>CPF: <input type="text" id="cpf" required></label>

    <label>UF:
      <select id="uf" required>
        <option value="">Selecione</option>
        <option>AC</option><option>AL</option><option>AP</option><option>AM</option>
        <option>BA</option><option>CE</option><option>DF</option><option>ES</option>
        <option>GO</option><option>MA</option><option>MT</option><option>MS</option>
        <option>MG</option><option>PA</option><option>PB</option><option>PR</option>
        <option>PE</option><option>PI</option><option>RJ</option><option>RN</option>
        <option>RS</option><option>RO</option><option>RR</option><option>SC</option>
        <option>SP</option><option>SE</option><option>TO</option>
      </select>
    </label>

    <!-- Área travada -->
    <label>Área do imóvel (m²):
      <input type="text" id="area" required readonly class="locked" title="Campo definido pela simulação/tabela do município">
    </label>
    <div class="hint">A metragem é definida pela simulação/tabela do município e não pode ser editada.</div>

    <label>Município: <input type="text" id="municipio" required></label>
    <label>Bairro: <input type="text" id="bairro" required></label>
    <label>Logradouro (Rua, Avenida, Travessa etc.): <input type="text" id="rua" required></label>
    <label>Número do imóvel: <input type="text" id="numero" required></label>
    <label>Complemento (Ex: casa B, fundos, apto 101): <input type="text" id="complemento"></label>
    <label>Telefone: <input type="tel" id="telefone" required></label>

    <!-- Tipo travado (select desabilitado + hidden para submissão) -->
    <label>Tipo de imóvel:
      <select id="tipo" disabled class="locked" title="Campo definido pela simulação/tabela do município">
        <option value="">Selecione</option>
        <option value="Residencial">Residencial</option>
        <option value="Não Residencial">Não Residencial</option>
      </select>
      <input type="hidden" id="tipo_hidden" name="tipo">
    </label>
    <div class="hint">O tipo é definido pela simulação/tabela do município e não pode ser alterado.</div>

    <label>Indicação (quem indicou ou como ficou sabendo): <input type="text" id="indicacao"></label>
    <label>Observação: <textarea id="observacao" style="min-height: 80px;"></textarea></label>

    <label>Forma de pagamento: <input type="text" id="forma_pagamento" name="forma_pagamento" readonly class="locked"></label>
    <label>Qtd de parcelas: <input type="number" id="qtd_parcelas" name="qtd_parcelas" readonly class="locked"></label>
    <label>Valor da parcela (R$): <input type="text" id="valor_parcela" name="valor_parcela" readonly class="locked"></label>
    <label>Valor total (R$): <input type="text" id="valor_total" name="valor_total" readonly class="locked"></label>

    <label>Termo de Adesão:</label>
    <textarea id="termo" readonly></textarea>

    <label class="checkbox">
      <input type="checkbox" id="aceite">
      Declaro que os dados fornecidos são verdadeiros, que desejo aderir ao programa de REURB e autorizo contato por parte da JBD.
    </label>
    <button type="submit" id="enviar" disabled>✔ Aceito e Enviar</button>
  </form>

  <p style="text-align: right; font-size: 12px; color: #666; margin-top: 10px;">Versão: 1.0.0</p>
</div>

<script>
/* ---------- Helpers p/ leitura dos parâmetros ---------- */
function decodePlus(str) {
  if (str == null) return "";
  try {
    return decodeURIComponent(String(str).replace(/\+/g, " "));
  } catch {
    return String(str).replace(/\+/g, " ");
  }
}
function getFirstParam(params, names) {
  for (const n of names) {
    if (params.has(n)) return decodePlus(params.get(n));
  }
  return "";
}
function normalizeTipo(raw) {
  const v = (raw || "").toString().trim();
  if (/^residencial$/i.test(v)) return "Residencial";
  if (/^(nao_residencial|não\s*residencial|nao\s*residencial)$/i.test(v)) return "Não Residencial";
  // fallback: capitalize simples
  return v ? v.charAt(0).toUpperCase() + v.slice(1) : "";
}

/* ---------- Preenchimento automático vindo da calculadora ---------- */
window.addEventListener('DOMContentLoaded', () => {
  const params = new URLSearchParams(window.location.search);

  const campoForma       = document.getElementById('forma_pagamento');
  const campoParcelas    = document.getElementById('qtd_parcelas');
  const campoParcela     = document.getElementById('valor_parcela');
  const campoTotal       = document.getElementById('valor_total');
  const selectTipo       = document.getElementById('tipo');         // desabilitado
  const hiddenTipo       = document.getElementById('tipo_hidden');  // vai no POST
  const campoArea        = document.getElementById('area');         // readonly

  // aceita tanto 'tipo' quanto 'tipo_imovel'
  const formaParam    = getFirstParam(params, ['forma_pagamento']);
  const parcelasParam = getFirstParam(params, ['qtd_parcelas', 'parcelas']);
  const parcelaParam  = getFirstParam(params, ['valor_parcela']);
  const totalParam    = getFirstParam(params, ['valor_total', 'total']);
  const tipoParamRaw  = getFirstParam(params, ['tipo', 'tipo_imovel']);
  const metragem      = getFirstParam(params, ['metragem', 'area', 'metragem_total']);

  const tipoNormalizado = normalizeTipo(tipoParamRaw);

  if (campoForma)    campoForma.value    = formaParam;
  if (campoParcelas) campoParcelas.value = parcelasParam;
  if (campoParcela)  campoParcela.value  = parcelaParam;
  if (campoTotal)    campoTotal.value    = totalParam;
  if (campoArea)     campoArea.value     = metragem;

  if (selectTipo && hiddenTipo) {
    let opt = Array.from(selectTipo.options).find(o => o.value === tipoNormalizado);
    if (!opt && tipoNormalizado) {
      opt = document.createElement('option');
      opt.value = tipoNormalizado;
      opt.textContent = tipoNormalizado;
      selectTipo.appendChild(opt);
    }
    if (tipoNormalizado) {
      selectTipo.value = tipoNormalizado;
      hiddenTipo.value = tipoNormalizado;
    } else {
      hiddenTipo.value = selectTipo.value || '';
    }
  }

  if (typeof atualizarTermo === 'function') atualizarTermo();
});

/* ---------- Termo de adesão dinâmico (igual ao seu) ---------- */
function atualizarTermo() {
  const nome = document.getElementById('nome').value;
  const rg = document.getElementById('rg').value;
  const orgao = document.getElementById('orgao').value;
  const cpf = document.getElementById('cpf').value;
  const area = document.getElementById('area').value;
  const municipio = document.getElementById('municipio').value;
  const bairro = document.getElementById('bairro').value;
  const rua = document.getElementById('rua').value;
  const numero = document.getElementById('numero').value;
  const telefone = document.getElementById('telefone').value;
  const tipo = document.getElementById('tipo_hidden').value || document.getElementById('tipo').value;

  if (!nome || !rg || !orgao || !cpf || !area || !municipio || !bairro || !rua || !numero || !telefone || !tipo) {
    document.getElementById('termo').value = '';
    return;
  }

  const texto = `Eu, ${nome}, portador(a) da Carteira de Identidade nº ${rg}, ${orgao}, inscrito(a) no CPF/MF sob o nº ${cpf}, abaixo assinado, detentor da posse do imóvel de ${area}m² situado na cidade de ${municipio}, Bairro ${bairro}, Rua ${rua}, nº ${numero}, telefone ${telefone}, DECLARO que possuo interesse na realização da regularização fundiária REURB, nos termos da Lei Federal nº 13.465/2017 e Decreto Federal Nº 9.310, de 15 de março de 2018.

Para dar efeito a este instrumento, firmo o presente TERMO DE ADESÃO, autorizando desde já a empresa JBD PRESTADORA DE SERVIÇOS, CONSULTORIA E ASSESSORIA LTDA, situada na Avenida Rubens Rangel, 459 – Sala 105 - Campo de Aviação – Marataízes/ES, inscrita sob o CNPJ Nº 33.181.342/0001-04, a execução dos serviços que se fizerem necessários, obedecidos os princípios legais que regem a REGULARIZAÇÃO FUNDIÁRIA URBANA, bem como a emissão do contrato e respectivos boletos nos moldes da presente proposta a ser escolhida, conforme as tabelas, em anexo.

No caso de se verificar durante a execução do serviço que a metragem do imóvel é diferente da informada neste termo de adesão, o contrato será ajustado de acordo com a tabela, em anexo.

DECLARO também estar ciente de que a viabilização da execução dos serviços ficará condicionada ao licenciamento urbanístico e aprovações junto ao município de ${municipio}.`;

  document.getElementById('termo').value = texto;
}

document.getElementById('aceite').addEventListener('change', function () {
  document.getElementById('enviar').disabled = !this.checked;
});

// Inputs que disparam atualização do termo
['nome','rg','orgao','cpf','area','municipio','bairro','rua','numero','telefone']
  .forEach(id => {
    const el = document.getElementById(id);
    if (el) el.addEventListener('input', atualizarTermo);
  });

// Select UF
document.getElementById('uf').addEventListener('change', atualizarTermo);
</script>
</body>
</html>
