<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formulário de Adesão - REURB</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <img src="logo.png" alt="Logo JBD" class="logo">
        <h1>Formulário de Adesão</h1>
        <form id="adesao-form">
            <label>Nome:<input type="text" name="nome" required></label>
            <label>RG:<input type="text" name="rg"></label>
            <label>Órgão Expedidor:<input type="text" name="orgao"></label>
            <label>CPF:<input type="text" name="cpf" required></label>
            <label>UF:<input type="text" name="uf"></label>
            <label>Área (m²):<input type="number" name="area" id="area" required></label>
            <label>Município:<input type="text" name="municipio" id="municipio" required readonly></label>
            <label>Bairro:<input type="text" name="bairro"></label>
            <label>Logradouro:<input type="text" name="rua"></label>
            <label>Número do Imóvel:<input type="text" name="numero"></label>
            <label>Complemento:<input type="text" name="complemento"></label>
            <label>Telefone:<input type="tel" name="telefone"></label>
            <label>Tipo de Imóvel:<input type="text" name="tipo" id="tipo" readonly required></label>
            <label>Indicação:<input type="text" name="indicacao"></label>
            <label>Observação:<textarea name="observacao"></textarea></label>
            <label>Forma de pagamento:<input type="text" name="forma_pagamento" id="forma_pagamento" readonly required></label>
            <label>Qtd parcelas:<input type="number" name="qtd_parcelas" id="qtd_parcelas" readonly required></label>
            <label>Valor da parcela:<input type="text" name="valor_parcela" id="valor_parcela" readonly required></label>
            <label>Valor total:<input type="text" name="valor_total" id="valor_total" readonly required></label>
            
            <input type="submit" value="Enviar">
        </form>
        <p id="status"></p>
        <p class="versao">Versão do script: adesao-v1.3</p>
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const urlParams = new URLSearchParams(window.location.search);
            const campos = ['forma_pagamento', 'qtd_parcelas', 'valor_parcela', 'valor_total', 'tipo', 'metragem'];
            campos.forEach(campo => {
                const valor = urlParams.get(campo);
                if (valor !== null) {
                    const input = document.getElementById(campo);
                    if (input) input.value = valor;
                }
            });

            // Preenche o campo de área se vier via "metragem"
            const metragem = urlParams.get('metragem');
            if (metragem) {
                document.getElementById('area').value = metragem;
            }

            // Preenche campo tipo se vier via URL e protege
            const tipo = urlParams.get('tipo');
            if (tipo) {
                document.getElementById('tipo').value = tipo;
            }

            // Protege o campo municipio de edição manual
            const municipioInput = document.getElementById('municipio');
            if (municipioInput) {
                municipioInput.readOnly = false;
            }

            document.getElementById('adesao-form').addEventListener('submit', async (e) => {
                e.preventDefault();
                const dados = Object.fromEntries(new FormData(e.target));

                const response = await fetch('https://hook.us2.make.com/lq7d92kykma0i4l17absp7huwifbmy7r', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(dados)
                });

                const status = document.getElementById('status');
                if (response.ok) {
                    status.textContent = 'Enviado com sucesso!';
                    status.style.color = 'green';
                    e.target.reset();
                } else {
                    status.textContent = 'Erro ao enviar os dados.';
                    status.style.color = 'red';
                }
            });
        });
    </script>
</body>
</html>
